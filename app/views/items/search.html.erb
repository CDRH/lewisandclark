<h2>Search</h2>

<!-- search form -->
<div class="row">
  <div class="col-md-3">
    <%= form_tag(search_path, :method => "get", :class => "") do %>
      <div class="form-group">
        <%= hidden_field_tag(:qfield, "text") %>
        <%= text_field_tag(:qtext, params[:qtext], :placeholder => "Search", :class => "form-control main_search_text") %>
        <%# add facets to hidden fields %>
        <% Facets.facet_list.each do |facet| %>
          <%= hidden_field_tag(facet, params[facet]) if params[facet] %>
        <% end %>
        <% if params[:qtext] %>
          <%= link_to "x", clear_search, :class => "brn btn-warning clear_main_search_text" %>
        <% end %>
        <button type="button" class="btn btn-link pull-left"  data-toggle="collapse" data-target="#search_help" aria-expanded="false" aria-controls="search_help">Search Options</button>
        <%= submit_tag("Search", :class => "btn btn-info submit_main_search_text pull-right") %>
      </div>
      <br/>
      <div class="collapse" id="search_help">
      <div class="well">
         <p >Advanced searching: you can exclude with a "-", use boolean operators like AND & OR, group items with (parentheses), and search for a phrase with "quotation marks."</p>
      </div>
    </div>
     
    <% end %>





    <!-- clear facets -->
    <% if any_facets_selected? %>
      <div class="clear-filters-container">
        <%= link_to search_path({:qfield => params[:qfield], :qtext => params[:qtext]}),  {}, {class: "btn btn_default"} do %>
          Clear all filters 
          <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
          
        <% end %>
      </div>
    <% end %>

    <!-- facets -->
    <%= render partial: "facets", locals: {facets: @facets} %>
  </div> <!-- col-md-3 -->

  <div class="col-md-9">
    <!-- sorting and pagination -->
    <div class="row search_controls">
      <div class="col-md-3 search_limit">
        <% if (@items[:num_found] > 1) %>
          <%= render partial: "sort", 
            locals: { sort_by: params[:sort], page_type: @page_type, query: params[:qtext]
            } %>
        <% end %>
      </div>
      <div class="col-md-9 pagination_container">
        <%= paginator(@total_pages) %>
      </div>
    </div>

    <!-- search results section -->
    <h4>Your search for <%= params[:qtext] %> returned <%= @items[:num_found] %> <%= result_text(@items[:num_found]) %></h4>


    <% if @items[:num_found] > 0 %>
      <% @items[:docs].each do |doc| %>
        <div class="searchResults">
          <div class="row">
            <div class="col-md-12 search_results_info">
              <%= link_to doc["title"], item_path(doc["id"]) %>
              <ul>
                <li><strong>Date</strong>: <%= doc["dateDisplay"] %></li>
                <li><strong>Creator</strong>: <%= doc["creator"] %></li>
                <li><strong>Source</strong>: <%= doc["source"] %></li>
              </ul>
            </div>
            <%# enable this to see highlighting results from query %>
            <!-- <div class="col-md-8 search_results_text">
              <%# text = doc['highlight'] ? doc['highlight'].html_safe : doc['text'][0] %>
              <%# text %>
            </div> -->
          </div>
        </div>
      <% end %>
    <% end %>

    <div class="col-md-9 pagination_container">
      <%= paginator(@total_pages) %>
    </div>
  </div>
</div>
